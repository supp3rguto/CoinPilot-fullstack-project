<header class="content-header">
  <h1>Dashboard Financeiro</h1>
</header>

<div class="spinner-container" *ngIf="isLoading">
  <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
</div>

<div *ngIf="financeData">

  <div class="financial-grid">
    <mat-card class="stat-card profit">
      <mat-card-header><mat-card-title>Lucro Total</mat-card-title></mat-card-header>
      <mat-card-content>
        <span class="stat-value">{{ financeData.totalProfit | currency:'BRL' }}</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card revenue">
      <mat-card-header><mat-card-title>Receita Total</mat-card-title></mat-card-header>
      <mat-card-content>
        <span class="stat-value">{{ financeData.totalRevenue | currency:'BRL' }}</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card cost">
      <mat-card-header><mat-card-title>Custo Total</mat-card-title></mat-card-header>
      <mat-card-content>
        <span class="stat-value">{{ financeData.totalCost | currency:'BRL' }}</span>
      </mat-card-content>
    </mat-card>
    
    <mat-card class="stat-card">
      <mat-card-header><mat-card-title>Total de Vendas</mat-card-title></mat-card-header>
      <mat-card-content>
        <span class="stat-value">{{ financeData.totalTransactions }}</span>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="data-grid">
    <mat-card class="chart-card">
      <mat-card-content>
        <h3>Lucro por Rota</h3>
        <ngx-charts-bar-vertical
          [view]="[600, 300]"
          [scheme]="'cool'"
          [results]="financeData.profitByRoute"
          [xAxis]="true"
          [yAxis]="true"
          [showXAxisLabel]="true"
          [showYAxisLabel]="true"
          [xAxisLabel]="'Rota'"
          [yAxisLabel]="'Lucro (R$)'"
          [yAxisTickFormatting]="formatProfit">
        </ngx-charts-bar-vertical>
      </mat-card-content>
    </mat-card>
    
    <mat-card class="table-card">
      <mat-card-content>
        <h3>Feed de Vendas (Ãšltimas 5)</h3>
        <table mat-table [dataSource]="financeData.latestTransactions">
          
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> ID </th>
            <td mat-cell *matCellDef="let t"> {{t.id}} </td>
          </ng-container>
          
          <ng-container matColumnDef="routeName">
            <th mat-header-cell *matHeaderCellDef> Rota </th>
            <td mat-cell *matCellDef="let t"> {{t.routeName}} </td>
          </ng-container>
          
          <ng-container matColumnDef="cost">
            <th mat-header-cell *matHeaderCellDef> Custo </th>
            <td mat-cell *matCellDef="let t" class="cost-cell"> {{t.cost | currency:'BRL'}} </td>
          </ng-container>
          
          <ng-container matColumnDef="revenue">
            <th mat-header-cell *matHeaderCellDef> Receita </th>
            <td mat-cell *matCellDef="let t" class="revenue-cell"> {{t.revenue | currency:'BRL'}} </td>
          </ng-container>
          
          <ng-container matColumnDef="profit">
            <th mat-header-cell *matHeaderCellDef> Lucro </th>
            <td mat-cell *matCellDef="let t" class="profit-cell"> {{t.profit | currency:'BRL'}} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>
</div>